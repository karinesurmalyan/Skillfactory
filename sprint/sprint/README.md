<p>Компания SkillFactory получила заказ от Федерации Спортивного Туризма России (ФСТР).</p>
<p>Проблема, с которой обратились: ФСТР ведёт базу горных перевалов, которая пополняется туристами. 
После преодоления очередного перевала, турист заполняет отчёт в формате PDF и отправляет его на электронную почту федерации. Экспертная группа ФСТР получает эту информацию, верифицирует, а затем вносит её в базу, которая ведётся в Google-таблице.</p>
<p>Как заказчик хочет решить проблему: ФСТР заказала разработать мобильное приложение для Android и IOS, которое упростило бы туристам задачу по отправке данных о перевале и сократило время обработки запроса до трёх дней. Пользоваться мобильным приложением будут туристы. 
В горах они будут вносить данные о перевале в приложение и отправлять их в ФСТР, как только появится доступ в Интернет. 
Модератор из федерации будет верифицировать и вносить в базу данных информацию, полученную от пользователей, а те в свою очередь смогут увидеть в мобильном приложении статус модерации и просматривать базу с объектами, внесёнными другими.</p>

Для пользователя в мобильном приложении будут доступны следующие действия:
<ul>
    <li>Внесение информации о новом объекте (перевале) в карточку объекта;</li>
    <li>Редактирование в приложении неотправленных на сервер ФСТР данных об объектах. На перевале не всегда работает Интернет;</li>
    <li>Заполнение ФИО и контактных данных (телефон и электронная почта) с последующим их автозаполнением при внесении данных о новых объектах;</li>
    <li>Отправка данных на сервер ФСТР;</li>
    <li>Получение уведомления о статусе отправки (успешно/неуспешно;</li>
    <li>Согласие пользователя с политикой обработки персональных данных в случае нажатия на кнопку «Отправить» при отправке данных на сервер.</li>
</ul>
Пользователь с помощью мобильного приложения будет передавать в ФСТР следующие данные о перевале:
<ul>
    <li>координаты перевала и его высота;</li>
    <li>имя пользователя;</li>
    <li>почта и телефон пользователя;</li>
    <li>название перевала;</li>
    <li>несколько фотографий перевала.</li>
</ul>
После этого турист нажимает кнопку «Отправить» в мобильном приложении. Мобильное приложение вызовет метод <strong>Passage</strong>.

<strong>Метод:</strong>

`POST/Passages/`

принимает JSON в теле запроса с информацией о перевале. Пример:
```commandline
{
  "beauty_title": "пер. ",
  "title": "Пхия",
  "other_titles": "Триев",
  "connect": "", //что соединяет, текстовое поле
 
  "add_time": "2021-09-22 13:18:13",
  "user": {"email": "qwerty@mail.ru", 		
        "fam": "Пупкин",
		 "name": "Василий",
		 "otc": "Иванович",
        "phone": "+7 555 55 55"}, 
 
   "coords":{
  "latitude": "45.3842",
  "longitude": "7.1525",
  "height": "1200"}
 
 
  level:{"winter": "", //Категория трудности. В разное время года перевал может иметь разную категорию трудности
  "summer": "1А",
  "autumn": "1А",
  "spring": ""},
 
   images: [{data:"<картинка1>", title:"Седловина"}, {data:"<картинка>", title:"Подъём"}]
}
```
Результаты метода: JSON
<ul>
    <li><strong>status</strong> — код HTTP, целое число:</li>
    <ul>
        <li>500 — ошибка при выполнении операции;</li>
        <li>400 — Bad Request (при нехватке полей);</li>
        <li>200 — успех.</li>
    </ul>
    <li><strong>message</strong> — строка:</li>
    <ul>
        <li>Причина ошибки (если она была);</li>
        <li>Отправлено успешно;</li>
        <li>Если отправка успешна, дополнительно возвращается id вставленной записи.</li>
    </ul>
    <li><strong>id</strong> — идентификатор, который был присвоен объекту при добавлении в базу данных.</li>
</ul>

Примеры:
<ul>
    <li>{ "status": 500, "message": "Ошибка подключения к базе данных","id": null}</li>
    <li>{ "status": 200, "message": null, "id": 42 }</li>
</ul>

После того, как турист с помощью мобильного приложения добавит в БД информацию о новом перевале, сотрудники ФСТР проведут модерацию для каждого нового объекта и поменяют поле *status*. 

Допустимые значения поля *status*:
<ul>
    <li>new;</li>
    <li>pending — если модератор взял в работу;</li>
    <li>accepted — модерация прошла успешно;</li>
    <li>rejected — модерация прошла, информация не принята.</li>
</ul>

<strong>Метод:</strong>

`GET/passages/<id>`

<p>Получить одну запись (перевал) по её id.
Выводится вся информацию об объекте, в том числе статус модерации.</p>

<strong>Метод:</strong>

`PATCH/passages/<id>`
<p>Отредактировать существующую запись (замена), если она в статусе new.
Редактировать можно все поля, кроме тех, что содержат в себе ФИО, адрес почты и номер телефона. Метод принимает тот же самый json, который принимал уже реализованный метод Passage.</p>
В качестве результата возврвщаются два значения:
<ul>
    <li><strong>state:</strong></li>
    <ul>
        <li>1 — если успешно удалось отредактировать запись в базе данных.</li>
        <li>0 — в противном случае.</li>
    </ul>
    <li><strong>message</strong> — если обновить запись не удалось, напиши почему.</li>
</ul>

<strong>Метод:</strong>

`GET /passages/?user__email=<email>`
<p>Список данных обо всех объектах, которые пользователь с почтой 'email' отправил на сервер.</p>

<strong>Дополнительно:</strong>
<ol>
    <li>Реализовано повторное использование существующего объекта модели Users при создания нового объекта модели Passage. Если запрос (метод POST/Passages/) на добавление записи отправляет пользователь, ранее уже отправлявший такой запрос (определяется по email), то для текущей записи используются ранее записанные данные пользователя, а не создается новый пользователь (объект модели Users).</li>
    <li>Для создания и изменения объектов моделей со связанными данными вложенных сериализаторов использован пакет drf-writable-nested</li>
</ol>

<strong>Отчет о покрытии тестами</strong>

<img src='file:///Users/karinesurmalyan/Desktop/Снимок%20экрана%202024-07-18%20в%2000.20.39.png' />